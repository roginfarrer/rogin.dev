---
import { vars } from "../vars.css";
import Box from "./Box.astro";
import { TRANSITION } from "./HeaderNavItem.astro";
import { MoonIcon, SunIcon } from "@radix-ui/react-icons";
---

<script>
  function setup() {
    const handleToggleClick = () => {
      const element = document.documentElement;
      element.classList.toggle("dark");

      const isDark = element.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");

      const themeSwitcher = document.querySelector(
        "#theme-select-switcher",
      ) as HTMLSelectElement;
      if (themeSwitcher) {
        themeSwitcher.value = isDark ? "dark" : "light";
      }
    };

    document
      .querySelectorAll(".theme-toggle")
      .forEach((toggle) => toggle.addEventListener("click", handleToggleClick));
  }

  setup();

  document.addEventListener("astro:after-swap", setup);
</script>

<Box
  transition={TRANSITION}
  as="button"
  borderRadius="$md"
  p="$1"
  bg={{ _: "$gray4", hover: "$gray6" }}
  border={`2px solid ${vars.colors.gray6}`}
  size="32px"
  display="flex"
  placeItems="center"
  class="theme-toggle"
>
  <MoonIcon className="moon" />
  <SunIcon className="sun" />
</Box>

<style>
  .sun {
    display: none;
  }
  .moon {
    display: block;
  }

  :global(.dark) .sun {
    display: block;
  }
  :global(.dark) .moon {
    display: none;
  }
</style>
