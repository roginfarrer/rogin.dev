---
import { getCollection } from "astro:content";
import FormattedDate from "components/FormattedDate.astro";
import Layout from "layouts/ContentLayout.astro";
import Box from "components/Box.astro";

let posts = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
if (import.meta.env.PROD) {
  posts = posts.filter((p) => !p.data.draft);
}
---

<Layout
  title="Blog"
  description="Notes on web development, productivity, and more."
>
  <Box as="h1" typeScale={{ _: "$3xl", md: "$5xl" }} mb="$7" fontWeight="$bold">
    Writing
  </Box>
  <Box as="ul" display="flex" gap="$6" flexDirection="column">
    {
      posts.map(({ slug, data: { title, draft, date } }) => (
        <Box as="li">
          <Box as="span" display="block" typeScale="$xl" mb="$1">
            <Box
              fontWeight="$bold"
              as="a"
              color={{ hover: "$accent11" }}
              href={draft ? `/blog-drafts/${slug}` : `/blog/${slug}`}
            >
              {title}
            </Box>
            {draft && (
              <Box
                as="span"
                ml="$2"
                p="$2"
                bg="$accent11"
                color="white"
                borderRadius="4px"
                fontSize="$xs"
              >
                DRAFT
              </Box>
            )}
          </Box>
          <Box as="span" display="block" fontSize="$sm" color="$gray10">
            <FormattedDate date={date} />
          </Box>
        </Box>
      ))
    }
  </Box>
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    document.querySelector("#scrollTop")?.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  });
</script>
